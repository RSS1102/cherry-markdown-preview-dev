name: Auto Upload JSON Files

on:
  push: 
    branches: [ main ]  # 触发分支设置（可根据需要修改）

permissions:
  contents: write  # 精简权限配置[2,3](@ref)

jobs:
  find-and-upload:
    runs-on: ${{ matrix.platform }}
    strategy:
      fail-fast: false
      matrix:
        include:
          - platform: ubuntu-latest
            search_path: "packages/client/**/*.json"
          - platform: windows-latest
            search_path: "packages/client/**/*.json"
          - platform: macos-latest
            search_path: "packages/client/**/*.json"

    steps:
      - uses: actions/checkout@v4  # 代码检出（网页2/3/8共同推荐）

      - name: Locate JSON Files
        id: file-finder
        uses: dawidd6/action-find-files@v3
        with:
          directory: .
          patterns: ${{ matrix.search_path }}
          find_options: "-type f -print"
          separator: "\n"

      - name: Display File Paths  # 新增路径打印
        if: ${{ steps.file-finder.outputs.files != '' }}
        run: |
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "  发现JSON文件路径清单"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "${{ steps.file-finder.outputs.files }}" | tr '\n' ' '
          echo "\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

      - name: Upload Artifacts
        if: ${{ steps.file-finder.outputs.files != '' }}
        uses: actions/upload-artifact@v4
        with:
          name: json-${{ matrix.platform }}-${{ github.run_id }}
          path: ${{ steps.file-finder.outputs.files }}
          retention-days: 3  # 缩短保留周期（网页8建议优化存储）

      - name: Show Artifact Info  # 新增构件信息展示
        if: ${{ steps.file-finder.outputs.files != '' }}
        run: |
          echo "╭──────────────────────────────────────╮"
          echo "│  构件已上传至 GitHub Actions 面板     │"
          echo "│  访问路径：                           │"
          echo "│  https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          echo "╰──────────────────────────────────────╯"
